<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title id="title">后台管理系统</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="css/bootstrap-table.min.css">
    <link rel="stylesheet" href="css/bootstrap-editable.css">
    <link rel="stylesheet" href="assets/index.css">
    <script src="assets/index.js"></script>
    <script src="js/vue1.js"></script>
    <script src="js/axios.js"></script>
    <script src="assets/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=upXkuuhfOOuQkOlW7yxP0cVHRKIseXmc"></script>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="css/public.css"/>

    <link rel="stylesheet" href="css/bootstrap-datetimepicker.css"/>
    <!-- bootstrap-datetimepicker插件CSS-->

    <!-- Latest compiled and minified JavaScript -->
    <script src="js/bootstrap-table.min.js"></script>

    <!-- Latest compiled and minified Locales -->
    <script src="js/bootstrap-table-zh-CN.min.js"></script>


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/json2/20140204/json2.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js "></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <![endif]-->
</head>
<body>

<!-- dianchishu  -->
<div id="dianchishu" class="wrap-div">
    <div style="width: 600px;height: 32px;background: #636161;margin: 0 auto;margin-top: 100px;opacity: 1">
        <p class="wrap-title">电池详情</p>
    </div>
    <div style="width: 600px;background: #FFF;margin: 0 auto;opacity: 1">
        <div style="padding-top: 20px;padding-bottom: 80px">
            <table style="width: 95%;margin-left: 2.5%;text-align: center;" border="1" cellspacing="0">
                <thead>
                <tr style="margin-top: 20px;height: 30px;">
                    <th style="text-align: center;">电池规格</th>
                    <th style="text-align: center;">总电池数</th>
                    <th style="text-align: center;">已租赁数</th>
                    <th style="text-align: center;">待租赁数</th>
                    <th style="text-align: center;">租赁率</th>
                </tr>
                </thead>
                <tbody id="tbMain"></tbody>
            </table>
            <div style="float: right;margin-top: 30px;margin-right: 20px">
                <button type="button" class="btn btn-default" id="666"
                        style="width: 100px;background: #636161;color:#F3F3F3;display: inline-block">关闭
                </button>
            </div>
        </div>
    </div>
</div>
<!-- dianchishu  -->

<!-- Fixed navbar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="">
        <div class="navbar-header;">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="dropdown" id="name"><a class="dropdown-toggle" data-target="#" data-toggle="dropdown"
                                                  style="margin-left: 10%;     white-space: nowrap;" id="navbarID">{{navname}}</a>
                    <ul class="dropdown-menu" style="margin-left: 10%; white-space: nowrap;">
                        <li><a href="#" @click="changeName(index)" v-for="(item,index) in message">{{item.name}}</a>
                        </li>
                    </ul>
                </li>
                <li style="margin-left: 20px;"><a href="#">地图展示</a></li>
                <li id="tabOption"><a href="index.html">车况列表</a></li>
                <li><a href="#">车辆管理</a></li>
                <li><a href="wangdian.html">网点管理</a></li>
                <li><a href="#">用户管理</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class="content">
    <div class="container">
        <div class="fixed-table-toolbar">
            <ul class="nav nav-tabs mytabs" id="mytabs">
                <li class="item active" id="tabletab4"><a href="#">统计</a></li>
                <li class="item" id="tabletab2"><a href="#">仓库</a></li>
                <li class="item" id="tabletab1"><a href="#">分站</a></li>
                <li class="item" id="tabletab3"><a href="#">驿站</a></li>
            </ul>
        </div>
        <div id="toolbar">
            <div class="my-container-cheliang">

                <div data-toggle="distpicker" id="table1" class="form-inline topinline cheliang">
                    <select data-province="---- 选择省 ----" class="form-control selpr"></select>
                    <select data-city="---- 选择市 ----" class="form-control selci"></select>
                    <select data-district="---- 选择区 ----" style="display: none" class="form-control selco"></select>

                    <select type="text" name="sectionName-s" id="sectionName-s" class="form-control wangdianse">
                        <option selected="selected" value="0">---分站---</option>
                    </select>

                    <button type="button" class="mybtn button-primary searchDQ">查询</button>
                </div>
                <div data-toggle="distpicker" id="table2" class="form-inline topinline cheliang">

                    <select data-province="---- 选择省 ----" class="form-control selpr2"></select>
                    <select data-city="---- 选择市 ----" class="form-control selci2"></select>
                    <select data-district="---- 选择区 ----" style="display: none" class="form-control selco2"></select>

                    <select type="text" name="sectionName-s" id="sectionName-s2" class="form-control wangdianse">
                        <option selected="selected" value="0">---分站---</option>
                    </select>

                    <button type="button" class="mybtn button-primary searchDQ2">查询</button>
                </div>
                <div data-toggle="distpicker" id="table3" class="form-inline topinline cheliang">

                    <select data-province="---- 选择省 ----" class="form-control selpr3"></select>
                    <select data-city="---- 选择市 ----" class="form-control selci3"></select>
                    <select data-district="---- 选择区 ----" class="form-control selco3"></select>

                    <select type="text" name="sectionName-s" id="sectionName-s3" class="form-control wangdianse">
                        <option selected="selected" value="0">---分站---</option>
                    </select>

                    <button type="button" class="mybtn button-primary searchDQ3">查询</button>
                </div>
                <div data-toggle="distpicker" id="table4" class="form-inline topinline cheliang">
                </div>
                <script type="text/javascript">
                    document.getElementById("table1").style.display = "none";
                    document.getElementById("table2").style.display = "none";
                    document.getElementById("table3").style.display = "none";
                    document.getElementById("table4").style.display = "block";


                </script>
            </div>
        </div>
        <div id="map"></div>
        <table id="table"
               data-ajax="ajaxRequest"
               data-search="false"
               data-show-refresh="true"
               data-show-toggle="false"
               data-show-columns="true"
               data-show-export="false"
               data-toolbar="#toolbar"
               data-minimum-count-columns="2"
               data-pagination="true"
               data-id-field="ccuSn"
               data-page-list="[10, 20, 50, 100, ALL]"
               data-show-footer="false"
               data-side-pagination="server"
               data-url="http://cjl3.rokyinfo.net:7200/api-ebike/v3.1/ebikes/list?sort=ebike.create_time,desc&adminFlag=cjl"
               data-cache="true"
               data-response-handler="responseHandler">
        </table>

    </div>
</div>

</body>
<!--/jquery.文件-->
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script type="text/javascript" src="js/moment.js"></script>
<!-- 最新的 Bootstrap 核心 Moment文件 -->
<script type="text/javascript" src="js/bootstrap-datetimepicker.min.js"></script>
<!-- 最新的 Bootstrap 核心 DateTime文件 -->


<script>


    window.onload = function () {
        document.getElementById('name').disabled = true;
    };
    var nameindex = 0;
    document.getElementById("tabOption").getElementsByTagName("a")[0].style.color = "white";
    var $table = $('#table');
    var dataResult;
    var rr = 1;
    var orFault;
    var orOnLine;
    var timer = 0;
    var cc = 0;
    var timer2 = 0;
    $("#tabletab1").on("click", function () {
        document.getElementById("table1").style.display = "block";
        document.getElementById("table2").style.display = "none";
        document.getElementById("table3").style.display = "none";
        document.getElementById("table4").style.display = "none";

    });
    $("#tabletab2").on("click", function () {
        document.getElementById("table1").style.display = "none";
        document.getElementById("table2").style.display = "block";
        document.getElementById("table3").style.display = "none";
        document.getElementById("table4").style.display = "none";

    });
    $("#tabletab3").on("click", function () {
        document.getElementById("table1").style.display = "none";
        document.getElementById("table2").style.display = "none";
        document.getElementById("table3").style.display = "block";
        document.getElementById("table4").style.display = "none";

    });
    $("#tabletab4").on("click", function () {
        document.getElementById("table1").style.display = "none";
        document.getElementById("table2").style.display = "none";
        document.getElementById("table3").style.display = "none";
        document.getElementById("table4").style.display = "block";

    });

    var url;
    url = "http://cjl3.rokyinfo.net:7200/api-ebike/v3.1/ebikes/rent-statistics-summary";
    $(function () {

        $("#mytabs li").click(function () {
            $(this).siblings('li').removeClass('active');  // 删除其他兄弟元素的样式

            $(this).addClass('active');                            // 添加当前元素的样式
            $(".item").each(function (index, element) {
                if ($(this).hasClass("active")) {

                    if ($(this).text() == "仓库") {
                        url = "http://cjl3.rokyinfo.net:7200/api-user/v3.1/ebikestores?category=0&showFlag=0&sort=code,asc&model=list";
                        $(function () {
                            initTable();
                            $table.bootstrapTable("hideColumn", "zhandian");
                            $table.bootstrapTable("hideColumn", "zongshu");
                            $table.bootstrapTable("hideColumn", "yizu");
                            $table.bootstrapTable("hideColumn", "daizu");
                            $table.bootstrapTable("hideColumn", "zulinlv");
                            $table.bootstrapTable("hideColumn", "k");
                            $table.bootstrapTable("hideColumn", "l");
                            $table.bootstrapTable("hideColumn", "m");
                            $table.bootstrapTable("hideColumn", "depositAmount");
                            $table.bootstrapTable("hideColumn", "balance");
                            $table.bootstrapTable("hideColumn", "income");
                            $table.bootstrapTable("hideColumn", "batteryRentedCount");
                            $table.bootstrapTable("hideColumn", "batteryUnusedCount");
                            $table.bootstrapTable("hideColumn", "rentPercent");
                            $table.bootstrapTable("hideColumn", "dealer");
                            $table.bootstrapTable("hideColumn", "county");

                        });
                    } else if ($(this).text() == "分站") {
                        url = "http://cjl3.rokyinfo.net:7200/api-user/v3.1/ebikestores?category=1&showFlag=0&sort=code,asc&model=list";
                        $(function () {
                            initTable();
                            $table.bootstrapTable("hideColumn", "zhandian");
                            $table.bootstrapTable("hideColumn", "zongshu");
                            $table.bootstrapTable("hideColumn", "yizu");
                            $table.bootstrapTable("hideColumn", "daizu");
                            $table.bootstrapTable("hideColumn", "zulinlv");
                            $table.bootstrapTable("hideColumn", "m");
                            $table.bootstrapTable("hideColumn", "name");
                            $table.bootstrapTable("hideColumn", "dealer");
                            $table.bootstrapTable("hideColumn", "county");
                        });
                    } else if ($(this).text() == "驿站") {
                        url = "http://cjl3.rokyinfo.net:7200/api-user/v3.1/ebikestores?category=2&showFlag=0&sort=code,asc&model=list";
                        $(function () {
                            initTable();
                            $table.bootstrapTable("hideColumn", "zhandian");
                            $table.bootstrapTable("hideColumn", "zongshu");
                            $table.bootstrapTable("hideColumn", "yizu");
                            $table.bootstrapTable("hideColumn", "daizu");
                            $table.bootstrapTable("hideColumn", "zulinlv");
                            $table.bootstrapTable("hideColumn", "name");
                            $table.bootstrapTable("hideColumn", "depositAmount");
                            $table.bootstrapTable("hideColumn", "k");
                        });
                    } else if ($(this).text() == "统计") {
                        url = "http://cjl3.rokyinfo.net:7200/api-ebike/v3.1/ebikes/rent-statistics-summary";
                        $(function () {
                            initTable();
                            $table.bootstrapTable("hideColumn", "code");
                            $table.bootstrapTable("hideColumn", "province");
                            $table.bootstrapTable("hideColumn", "city");
                            $table.bootstrapTable("hideColumn", "county");
                            $table.bootstrapTable("hideColumn", "name");
                            $table.bootstrapTable("hideColumn", "k");
                            $table.bootstrapTable("hideColumn", "l");
                            $table.bootstrapTable("hideColumn", "m");
                            $table.bootstrapTable("hideColumn", "depositAmount");
                            $table.bootstrapTable("hideColumn", "balance");
                            $table.bootstrapTable("hideColumn", "income");
                            $table.bootstrapTable("hideColumn", "batteryRentedCount");
                            $table.bootstrapTable("hideColumn", "batteryUnusedCount");
                            $table.bootstrapTable("hideColumn", "batteryTotalCount");
                            $table.bootstrapTable("hideColumn", "rentPercent");
                            $table.bootstrapTable("hideColumn", "dealer");
                        });
                    }
                    console.log(url)

                }
            });


        });

    });


    var title = document.getElementById("title");
    var navid = document.getElementById("navbarID");

    var source = null;
    // your custom ajax request here
    function ajaxRequest(params) {
        if (source != null) {
            source.cancel('Operation canceled by the user.');
            source = null
        }

        var CancelToken = axios.CancelToken;
        source = CancelToken.source();

        axios.get(params.url,{
            cancelToken: source.token,
            headers:{
                "Content-Type": "application/json;charset=UTF-8",
                "firm": JSON.parse(sessionStorage.name)[sessionStorage.Vname].flag,
                "Authorization": sessionStorage.token
            },
            params:params.data
        })
            .then(function(response){
                params.success(response.data)

            })
            .catch(function(error){
                console.log(error)
            });
    }

    function initTable() {
        $table.bootstrapTable("destroy");

        $table.bootstrapTable({
            height: getHeight(),
            url: url,
            method: 'GET',
            dataType: 'json',
            contentType: "application/json; charset=utf-8",
            cache: false,
            striped: true,                              //是否显示行间隔色
            onLoadError: function (data) {
                $table.bootstrapTable("refresh", {silent: true});
            },
            ajaxOptions: {
                headers: {
                    "firm": JSON.parse(sessionStorage.name)[sessionStorage.Vname].flag,
                    "Authorization": sessionStorage.token
                }
            },
            queryParams: queryParams,
            minimumCountColumns: 2,
            pageNumber: 1,                       //初始化加载第一页，默认第一页
            pageSize: 100,                       //每页的记录行数（*）
            pageList: [10, 20, 100],        //可供选择的每页的行数（*）
            columns: [

                {
                    field: '',
                    title: '',
                    align: 'center',
                    valign: 'middle',
                    formatter: function (value, row, index) {
                        /*console.log((dataResult.pageSize * (dataResult.currPage - 1)) + index + 1)*/
                        return (dataResult.pageSize * (dataResult.currPage - 1)) + index + 1;
                    }
                },
                {
                    field: 'zhandian',
                    title: '站点',
                    align: 'center',
                    valign: 'middle',
                    formatter: zhandianFormatter

                },
                {
                    field: 'zongshu',
                    title: '总电池数',
                    align: 'center',
                    valign: 'middle',
                    events: operateEvents,
                    formatter: zongshuFormatter

                },
                {
                    field: 'yizu',
                    title: '已租赁数',
                    align: 'center',
                    valign: 'middle',
                    formatter: yizuFormatter

                },
                {
                    field: 'daizu',
                    title: '待租赁数',
                    align: 'center',
                    valign: 'middle',
                    formatter: daizuFormatter

                },
                {
                    field: 'zulinlv',
                    title: '租赁率',
                    align: 'center',
                    valign: 'middle',
                    formatter: zulinlvFormatter

                },


                {
                    field: 'code',
                    title: '编号',
                    align: 'center',
                    valign: 'middle'

                },
                {
                    field: 'province',
                    title: '省',
                    align: 'center',
                    valign: 'middle'

                },
                {
                    field: 'city',
                    title: '市',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    field: 'county',
                    title: '区/县',
                    align: 'center',
                    valign: 'middle'

                },
                {
                    field: 'name',
                    title: '仓库',
                    align: 'center',
                    valign: 'middle'
                },

                {

                    field: 'k',
                    title: '分站',
                    align: 'center',
                    valign: 'middle',
                    formatter: jxsFormatter

                },
                {

                    field: 'dealer',
                    title: '分站',
                    align: 'center',
                    valign: 'middle'

                },
                {
                    field: 'm',
                    title: '驿站',
                    align: 'center',
                    valign: 'middle',
                    formatter: mendianFormatter
                }, {
                    field: 'l',
                    title: '类型',
                    align: 'center',
                    valign: 'middle',
                    formatter: lxFormatter
                },

                {
                    field: 'depositAmount',
                    title: '保证金',
                    align: 'center',
                    valign: 'middle'
                }, {
                    field: 'balance',
                    title: '余额',
                    align: 'center',
                    valign: 'middle'

                },
                {
                    field: 'income',
                    title: '总收益',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    field: 'batteryTotalCount',
                    title: '总电池数',
                    align: 'center',
                    valign: 'middle',
                    events: operateEvents,
                    formatter: totalbattFormatter
                },
                {

                    field: 'batteryRentedCount',
                    title: '已租赁数',
                    align: 'center',
                    valign: 'middle'

                },

                {
                    field: 'batteryUnusedCount',
                    title: '待租赁数',
                    align: 'center',
                    valign: 'middle'
                },

                {
                    field: 'rentPercent',
                    title: '租赁率',
                    align: 'center',
                    valign: 'middle'
                }
            ]
        });
        // sometimes footer render error.
    }

    function zhandianFormatter(value, row, index) {
        var inner = row.storeCategoryName;

        return [
            '<span>' + inner + '</span>'
        ].join('');
    }//站点
    function zongshuFormatter(value, row, index) {
        return [
            '<div class="nowwrp">',
            '<a class="batterytotal" href="#" title="统计详情">',
            row.batteryTotalCount + "",
            '</a>',
            '</div>'
        ].join("")
    }//总电池数
    function yizuFormatter(value, row, index) {
        var inner = row.batteryRentedCount;

        return [
            '<span>' + inner + '</span>'
        ].join('');
    }//已租赁数
    function daizuFormatter(value, row, index) {
        var inner = row.batteryUnusedCount;

        return [
            '<span>' + inner + '</span>'
        ].join('');
    }//待租赁数
    function zulinlvFormatter(value, row, index) {
        var inner = row.rentPercent + "%";

        return [
            '<span>' + inner + '</span>'
        ].join('');
    }//租赁率
    function jxsFormatter(value, row, index) {
        var inner = row.name;

        return [
            '<span>' + inner + '</span>'
        ].join('');
    }//k分站
    function lxFormatter(value, row, index) {
        var inner;
        if (row.type == 40) {
            inner = "直营"
        } else if (row.type == 70) {
            inner = "代理"
        } else if (row.type == 80) {
            inn = "其他"
        } else {
            inner = ""
        }

        return [
            '<span>' + inner + '</span>'
        ].join('');
    }//类型
    function mendianFormatter(value, row, index) {
        var inner = row.name;

        return [
            '<span>' + inner + '</span>'
        ].join('');
    }//驿站
    function totalbattFormatter(value, row, index) {
        return [
            '<div class="nowwrp">',
            '<a class="batterytotal" href="#" title="电池详情">',
            row.batteryTotalCount + "",
            '</a>',
            '</div>'
        ].join("")
    }//总电池数
    function createTimeFormatter(value, row, index) {
        var inner = row.createTime;
        var color = 'nowwrp1';
        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');
    }//
    function reportTimerFormatter(value, row, index) {
        var inner = row.reportTime;
        var color = 'nowwrp1';
        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');
    }

    function snFormatter(value, row, index) {
        var inner;
        $(".item").each(function (index, element) {
            if ($(this).hasClass("active")) {
                if ($(this).text() == "异常电池") {
                    inner = row.ccuSn;
                }
                else {
                    inner = '<a id="like2" class="like2" href="#" title="车辆远程操控">' + row.ccuSn + '</a>';
                }
                return inner;
            }
            return inner
        });
        return [
            '<span>' + inner + '</span>'
        ].join("")

    }//序列号
    function volFormatter(value, row, index) {
        return [
            '<div class="nowwrp">',
            '<a class="like4" href="#" title="点击查看电压趋势">',
            row.voltageString,
            '</a>',
            '</div>'
        ].join("")

    }//电压
    function standFormatter(value, row, index) {
        var inner;
        if (row.productEntity != null && row.productEntity != "null") {
            if (row.productEntity.name != null && row.productEntity.name != "null") {
                inner = row.productEntity.name;
            }
            else {
                inner = "-";
            }
        }
        else {
            inner = "-";
        }
        return [
            '<span>' + inner + '</span>'
        ].join('');
    }//规格
    function lineFormatter(value, row, index) {
        var color = 'nowwrp';
        if (row.storeName == null) {
            inner = "";
            return [
                '<span class=' + color + '>' + inner + '</span>'
            ].join("")
        }
        else {

            inner = row.storeName;
            return [
                '<span class=' + color + '>' + inner + '</span>'
            ].join("")
        }
    }//网点
    function realFormatter(value, row, index) {
        var inner;
        if (row.owner == null || row.owner == "null") {
            inner = ""
        }
        else {
            if (row.owner.realname == null) {
                inner = ""
            }
            else {
                inner = row.owner.realname
            }
        }
        var color = 'nowwrp';
        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');
    }//用户姓名
    function linkFormatter(value, row, index) {
        if (row.owner == null || row.owner == "null") {
            inner = ""
        }
        else {
            var inner = row.owner.phoneNumber
        }
        var color = 'nowwrp'
        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');
    }//联系方式
    function yajin1Formatter(value, row, index) {
        if (row.orderEntity != null && row.orderEntity != "null") {
            var inner = row.orderEntity.deposit;
        } else {
            var inner = "-"
        }
        return [
            '<span>' + inner + '</span>'
        ].join("")
    }//押金
    function operateFormatter(value, row, index) {
        var car = row.ebikeStatus == 0 ? "img/u217.png" : row.ebikeStatus == 100 ? "img/u209.png" : "img/u207.png";
        return [
            '<a class="like" href="#">',
            '<img  class="smallImg" src=' + car + ' />',
            '</a>'
        ].join('');
    }

    function queryParams(params) {
        var param = {
            limit: this.pageSize, // 页面大小
            page: this.pageNumber,
            onLine: orOnLine,
            fault: orFault
        };

        return param;
    }

    function responseHandler(res) {
        dataResult = res;
        if (res) {
            return {
                "rows": res.list,
                "total": res.totalCount
            };
        } else {
            return {
                "rows": 10,
                "total": 20
            };
        }
        console.log(res);
    }

    function jinyongFormatter(value, row, index) {
        var inner;
        var gear = row.gear;
        if (gear == 17) {
            inner = "禁用"
        }
        else if (gear == 34) {
            inner = "启用"
        }
        else {
            inner = "-"
        }
        return [
            '<span>' + inner + '</span>'
        ].join('');
    }

    function onlineFormatter(value, row, index) {
        if (row.online == null) {
            inner = ""
        }
        else {
            var inner = row.online ? "在线" : "离线 "
            var color = row.online ? "" : "red"

        }

        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');

    } //在线
    function usestFormatter(value, row, index) {
        if (row.useStatus == null) {
            inner = ""
        }
        else {
            var inner = row.useStatus ? "冻结" : "正常 "
            var color = row.useStatus ? "red" : ""

        }

        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');
    }//使用状态
    function useFormatter(value, row, index) {
        var inner = row.usedDays + "天"
        return [
            '<span>' + inner + '</span>'
        ].join('');
    }//使用时间
    function zhuangtFormatter(value, row, index) {
        var inner;
        if (row.status == 3) {
            inner = "移动"
        }
        else {
            inner = "静止"
        }
        return [
            '<span>' + inner + '</span>'
        ].join('');

    }//状态
    function youxFormatter(value, row, index) {
        var color = 'nowwrp'
        var inner = row.surplusTime
        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');

    }	//有效期
    function simFormatter(value, row, index) {
        var color = 'nowwrp'

        if (row.simValidityTime == null) {
            inner = "-"
        }
        else {
            inner = row.simValidityTime
        }
        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');

    }	//sim
    function odoFormatter(value, row, index) {

        if (row.odo == null) {
            inner = "0km"
        }

        else {
            var inner = row.odo + "km"
        }
        return [
            '<a class="like5" href="#" title="点击查看里程变化">',
            '<span>' + inner + '</span>',
            '</a>'
        ].join('');
    }//里程
    function dayodoFormatter(value, row, index) {
        if (row.dayOdo == null) {
            inner = "0km"
        }
        else {
            var inner = row.dayOdo + "km"
        }
        return [
            '<a class="like6" href="#" title="当日轨迹">',
            '<span>' + inner + '</span>',
            '</a>'
        ].join('');
    }//今日里程
    function modoFormatter(value, row, index) {

        if (row.odo == null) {
            inner = "0km"
        }

        else {
            var inner = row.monthODO + "km"
        }
        return [

            '<span>' + inner + '</span>'

        ].join('');
    }//本月里程
    function liulFormatter(value, row, index) {
        if (row.dataUsage == -1) {
            var color = 'nowwrp'
            inner = "第三方SIM"
        }
        else {
            var inner = (row.dataUsage != "" ? (row.dataUsage + "M") : "-");
        }
        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');
    }//流量
    function flagFormatter(value, row, index) {
        var inner = row.faultFlag ? "有故障" : "无故障 "
        var color = row.faultFlag ? "red" : ""
        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');
    }  //故障
    function gztimeFormatter(value, row, index) {
        var color = 'nowwrp1'
        if (row.faultTime != null) {
            var inner = row.faultTime
        }
        else {
            inner = ""
        }
        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');
    }//故障时间
    function guzhangFormatter(value, row, index) {
        var color = 'nowwrp'
        if (row.faultDetail == null) {
            inner = ""
            return [
                '<span class=' + color + '>' + inner + '</span>'
            ].join('');

        }
        else {
            inner = row.faultDetail
            return [
                '<span class=' + color + '>' + inner + '</span>'
            ].join('');
        }
    }//故障详情
    function sourceFormatter(value, row, index) {
        var inner = row.source;
        if (row.source == 0) {
            inner = 'GPRS'
        }
        else if (row.source == 1) {
            inner = 'BT'
        }
        else {
            inner = ''
        }
        return [
            '<span>' + inner + '</span>'
        ].join('');
    }  //来源
    function bmcFormatter(value, row, index) {
        if (row.bmsSoc > 100) {
            var inner = row.bmsSoc ? row.bmsSoc - 100 + "格" : ""
            var color = row.bmsSoc - 100 == 2 ? "yellow" : row.bmsSoc - 100 == 1 ? "orange" : ""
        }
        else if (row.bmsSoc == 0) {
            if (row.bmsSoh > 100) {
                inner = "0格"
                color = "red"
            }
            else {
                inner = "0%"
                color = "red"
            }


        }
        else if (row.bmsSoc == null) {
            inner = "-"
        }
        else {
            var inner = row.bmsSoc + "%"
        }

        return [
            '<span class=' + color + '>' + inner + '</span>'
        ].join('');

    }  //电量
    function addressFormatter(value, row, index) {
        var inner = row.address;
        if (row.address == null) {
            inner = ''
        }
        return [
            '<a class="like7" href="#" title="查看当前定位">',
            '<i class="glyphicon glyphicon-map-marker">',
            '</i>',
            '</a>'
        ].join('');
    }  //地址
    function reasonFormatter(value, row, index) {
        var inner;
        if (row.bmsExceptionReason == 0) {
            inner = "离线"
        }
        else if (row.bmsExceptionReason == 1) {
            inner = "欠压"
        } else if (row.bmsExceptionReason == 2) {
            inner = "异动"
        } else {
            inner = "-"
        }
        return [
            '<span>' + inner + '</span>'
        ].join('');

    }

    function reportTimeFormatter(value, row, index) {
        var inner;
        if (row.reportTime == null || row.reportTime == "null") {
            inner = "";
            return [
                '<span>' + inner + '</span>'
            ].join('');
        } else {
            var date1 = row.reportTime;  //开始时间
            var date2 = new Date();    //结束时间
            var date3 = date2.getTime() - new Date(date1).getTime();   //时间差的毫秒数
            var xiaps = Math.floor(date3 / (3600 * 1000));
            if (Math.abs(xiaps) > 0) {
                var color = "red";
                inner = row.reportTime;
                return [
                    '<span class=' + color + '>' + inner + '</span>'
                ].join('');
            }
            else if (Math.abs(xiaps) < 0 || xiaps == 0) {
                inner = row.reportTime;
                return [
                    '<span>' + inner + '</span>'
                ].join('');
            }
            else {
                return [
                    '<span>' + inner + '</span>'
                ].join('');
            }
        }
    }//更新时间
    function removeFormatter(value, row, index) {
        return [
            '<div class="nowwrp">',
            '<a class="like8" href="#" title="移除电池号">',
            '<i class="glyphicon glyphicon-remove">',
            '</i>',
            '</a>',
            '</div>'
        ].join("")
    }

    var data1;

    function ajax(url, method, success, err) {
        $.ajax({
            url: url,
            method: method,
            contentType: "application/json; charset=utf-8",
            cache: false,
            beforeSend: function (xhr) {
                /* Authorization header */
                xhr.setRequestHeader("firm", sessionStorage.flag);
                xhr.setRequestHeader("Authorization", sessionStorage.token);
            },
            success: success,
            error: err
        });
    }  //ajax 封装
    ajax("http://cjl3.rokyinfo.net:7200/api-user/v3.1/ebikestores?types=1", "get", function (data) {
        data1 = data
    }, function (jqXHR, textStatus, errorThrown) {
        console.log("失败");
        console.log(jqXHR);
    });
    var ueId;
    var id1;

    var poins = function (data) {

        if (!data) return;
        var points = [];
        var num = parseInt(data.length / 10);

        function sliceArr(arr, size) {
            var result = [];
            for (var i = 0; i < Math.ceil(arr.length / size); i++) {
                var start = i * size;
                var end = (i + 1) * size;
                result.push(arr.slice(start, end))
            }

            return result
        }

        for (var i = 0; i < data.length; i++) {
            points.push(new BMap.Point(data[i]['lon'], data[i]['lat']))
        }
        var arr = sliceArr(points, 5);
        return arr
    };

    function addMarker(point) {

        var marker = new BMap.Marker(point);
        map.addOverlay(marker);
    }

    var operateEvents = {
        'click .batterytotal': function (e, value, row, index) {
            $(".item").each(function (index, element) {
                console.log("http://cjl3.rokyinfo.net:7200/api-ebike/v3.1/ebikes/" + row.ccuSn + "/clean-exception-flag");
                if ($(this).hasClass("active")) {

                    if ($(this).text() == "统计") {
                        $.ajax({
                            url: "http://cjl3.rokyinfo.net:7200/api-ebike/v3.1/ebikes/rent-statistics-by-category?category=" + row.category,
                            method: "get",
                            contentType: "application/json; charset=utf-8",
                            cache: false,
                            beforeSend: function (xhr) {
                                /* Authorization header */
                                xhr.setRequestHeader("firm", sessionStorage.firmFlag);
                                xhr.setRequestHeader("Authorization", sessionStorage.token);
                            },
                            success: function (data) {
                                render(data)

                                function render(list) {
                                    for (var i = 0; i < list.length; i++) {
                                        var tr = document.createElement('tr')
                                        tr.innerHTML = '<td>' + list[i].specification + '</td><td>' + list[i].batteryTotalCount + '</td><td>' + list[i].batteryRentedCount + '</td><td>' + list[i].batteryUnusedCount + '</td><td>' + list[i].rentPercent + '%' + '</td>'
                                        document.getElementById('tbMain').appendChild(tr)
                                    }
                                }


                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                console.log("失败");
                                console.log(jqXHR);
                            }
                        });


                    }
                    else {
                        $.ajax({
                            url: "http://cjl3.rokyinfo.net:7200/api-ebike/v3.1/ebikes/rent-statistics?storeId=" + row.id,
                            method: "get",
                            contentType: "application/json; charset=utf-8",
                            cache: false,
                            beforeSend: function (xhr) {
                                /* Authorization header */
                                xhr.setRequestHeader("firm", sessionStorage.firmFlag);
                                xhr.setRequestHeader("Authorization", sessionStorage.token);
                            },
                            success: function (data) {
                                render(data)

                                function render(list) {
                                    for (var i = 0; i < list.length; i++) {
                                        var tr = document.createElement('tr')
                                        tr.innerHTML = '<td>' + list[i].specification + '</td><td>' + list[i].batteryTotalCount + '</td><td>' + list[i].batteryRentedCount + '</td><td>' + list[i].batteryUnusedCount + '</td><td>' + list[i].rentPercent + '%' + '</td>'
                                        document.getElementById('tbMain').appendChild(tr)
                                    }
                                }


                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                console.log("失败");
                                console.log(jqXHR);
                            }
                        });

                    }


                }
            });

            $("#dianchishu").show()
            $("#666").on("click", function () {
                $("#tbMain  tr").empty("")
                $("#dianchishu").hide()
            })
        }//总电池数
    };

    function getHeight() {
        if (document.body.clientWidth > 1389) {
            return $(window).height() - $('h1').outerHeight(true) - $('nav').outerHeight(true) - 42;
        } else {
            return $(window).height() - $('h1').outerHeight(true) - $('nav').outerHeight(true) - 70;
        }
    }

    initTable();

    $(window).resize(function () {
        $table.bootstrapTable('resetView', {
            height: getHeight()
        });
    });


    $("#wrap-btn-on").on("click", function () {
        console.log("cjl3.rokyinfo.net:7200/api-ebike/v3.1/ues/update_storeId?storeId=" + id1 + "&ueId=" + ueId);
        console.log("已发送");
        $.ajax({
            url: "http://cjl3.rokyinfo.net:7200/api-ebike/v3.1/ues/update_storeId?storeId=" + id1 + "&ueId=" + ueId,
            method: "put",
            contentType: "application/json; charset=utf-8",
            cache: false,
            beforeSend: function (xhr) {
                /* Authorization header */
                xhr.setRequestHeader("firm", sessionStorage.flag);
                xhr.setRequestHeader("Authorization", sessionStorage.token);
            }, success: function (data) {
                console.log("成功");
                $table.bootstrapTable("refresh", {silent: true});
                $("#wrap").hide()
            },
            error: function (err) {
                console.log(err)
            }
        })
    });
    $("#wrap-btn-off").on("click", function () {
        $("#wrap").hide()
    });
    $(".searchDQ").on("click", function () {
        var url;
        var a = $(".selpr").val();
        console.log(a);
        var b = $(".selci").val();

        var myselect = document.getElementById("sectionName-s");
        var index = myselect.selectedIndex;
        idstore1 = myselect.options[index].value;
        console.log(idstore1);
        url = "http://cjl3.rokyinfo.net:7200/api-user/v3.1/ebikestores?category=1&showFlag=0&sort=code,asc&model=list";
        if (idstore1 == "0") {
            url = url
        } else {
            url = url + "&id=" + idstore1
        }
        if (a == "") {
            url = url
        } else {
            url = url + "&province=" + a
        }

        if (b == "") {
            url = url
        } else {
            url = url + "&city=" + b
        }


        console.log(url)

        $.ajax({
            url: url,
            method: "get",
            contentType: "application/json; charset=utf-8",
            cache: false,
            beforeSend: function (xhr) {
                /* Authorization header */
                xhr.setRequestHeader("firm", sessionStorage.firmFlag);
                xhr.setRequestHeader("Authorization", sessionStorage.token);
            },
            success: function (data) {
                console.log("liebiao1");
                $("#table").bootstrapTable('refresh', {'url': url});

            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log("失败");
                console.log(jqXHR);
            }
        });

    });//分站
    $(".searchDQ2").on("click", function () {
        var url;
        var a = $(".selpr2").val();
        console.log(a);
        var b = $(".selci2").val();

        var myselect = document.getElementById("sectionName-s2");
        var index = myselect.selectedIndex;
        idstore1 = myselect.options[index].value;
        console.log(idstore1);
        url = "http://cjl3.rokyinfo.net:7200/api-user/v3.1/ebikestores?category=0&showFlag=0&sort=code,asc&model=list";
        if (idstore1 == "0") {
            url = url
        } else {
            url = url + "&id=" + idstore1
        }
        if (a == "") {
            url = url
        } else {
            url = url + "&province=" + a
        }

        if (b == "") {
            url = url
        } else {
            url = url + "&city=" + b
        }
        console.log(url)

        $.ajax({
            url: url,
            method: "get",
            contentType: "application/json; charset=utf-8",
            cache: false,
            beforeSend: function (xhr) {
                /* Authorization header */
                xhr.setRequestHeader("firm", sessionStorage.firmFlag);
                xhr.setRequestHeader("Authorization", sessionStorage.token);
            },
            success: function (data) {
                console.log("liebiao2");
                $("#table").bootstrapTable('refresh', {'url': url});

            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log("失败");
                console.log(jqXHR);
            }
        });

    });//仓库
    $(".searchDQ3").on("click", function () {
        var url;
        var a = $(".selpr3").val();
        console.log(a);
        var b = $(".selci3").val();
        var c = $(".selco3").val();

        var myselect = document.getElementById("sectionName-s3");
        var index = myselect.selectedIndex;
        idstore1 = myselect.options[index].value;
        console.log(idstore1);

        url = "http://cjl3.rokyinfo.net:7200/api-user/v3.1/ebikestores?category=2&showFlag=0&sort=code,asc&model=list";
        if (a == "") {
            if (idstore1 == "0") {
                url = url
            } else {
                url = url + "&parentId=" + idstore1
            }

        } else {
            if (b == "") {
                if (idstore1 == "0") {
                    url = url + "&province=" + a
                } else {
                    url = url + "&province=" + a + "&parentId=" + idstore1
                }
            } else {
                if (c == "") {
                    if (idstore1 == "0") {
                        url = url = url + "&province=" + a + "&city=" + b
                    } else {
                        url = url = url + "&province=" + a + "&city=" + b + "&parentId=" + idstore1
                    }
                } else {
                    if (idstore1 == "0") {
                        url = url = url + "&province=" + a + "&city=" + b + "&county=" + c
                    } else {
                        url = url = url + "&province=" + a + "&city=" + b + "&county=" + c + "&parentId=" + idstore1
                    }
                }
            }
        }
        console.log(url)
        $.ajax({
            url: url,
            method: "get",
            contentType: "application/json; charset=utf-8",
            cache: false,
            beforeSend: function (xhr) {
                /* Authorization header */
                xhr.setRequestHeader("firm", sessionStorage.firmFlag);
                xhr.setRequestHeader("Authorization", sessionStorage.token);
            },
            success: function (data) {

                $("#table").bootstrapTable('refresh', {'url': url});

            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log("失败");
                console.log(jqXHR);
            }
        });

    });//驿站


</script>
<script type="text/javascript">

    $(function () {

        $table.bootstrapTable("hideColumn", "code");
        $table.bootstrapTable("hideColumn", "province");
        $table.bootstrapTable("hideColumn", "city");
        $table.bootstrapTable("hideColumn", "county");
        $table.bootstrapTable("hideColumn", "name");
        $table.bootstrapTable("hideColumn", "k");
        $table.bootstrapTable("hideColumn", "l");
        $table.bootstrapTable("hideColumn", "m");
        $table.bootstrapTable("hideColumn", "depositAmount");
        $table.bootstrapTable("hideColumn", "balance");
        $table.bootstrapTable("hideColumn", "income");
        $table.bootstrapTable("hideColumn", "batteryRentedCount");
        $table.bootstrapTable("hideColumn", "batteryUnusedCount");
        $table.bootstrapTable("hideColumn", "batteryTotalCount");
        $table.bootstrapTable("hideColumn", "rentPercent");
        $table.bootstrapTable("hideColumn", "dealer");
        getMissiveType();
        getMissiveType1();
        getMissiveType2();
    });

    function getMissiveType() {
        $.ajax({
                url: "http://cjl3.rokyinfo.net:7200/api-user/v3.1/ebikestores?categories=1&showFlag=0&sort=code,asc&limit=100&page=1",
                method: "get",
                contentType: "application/json; charset=utf-8",
                processData: false,
                cache: false,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("firm", sessionStorage.firmFlag);
                    xhr.setRequestHeader("Authorization", sessionStorage.token);
                },
                success: function (data) {
                    var len = data.list.length;
                    $('#sectionName-s').attr("length", '0');
                    for (i = 0; i < len; i++) {
                        $("#sectionName-s").append($('<option value=' + data.list[i].id + '>' + data.list[i].name + '</option>'));
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    getMissiveType()
                }
            }
        );
    }

    function getMissiveType1() {
        $.ajax({
                url: "http://cjl3.rokyinfo.net:7200/api-user/v3.1/ebikestores?categories=0&showFlag=0&sort=code,asc&limit=100&page=1",
                method: "get",
                contentType: "application/json; charset=utf-8",
                processData: false,
                cache: false,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("firm", sessionStorage.firmFlag);
                    xhr.setRequestHeader("Authorization", sessionStorage.token);
                },
                success: function (data) {
                    var len = data.list.length;
                    $('#sectionName-s').attr("length", '0');
                    for (i = 0; i < len; i++) {

                        $("#sectionName-s2").append($('<option value=' + data.list[i].id + '>' + data.list[i].name + '</option>'));

                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    getMissiveType1()
                }
            }
        );
    }

    function getMissiveType2() {
        $.ajax({
                url: "http://cjl3.rokyinfo.net:7200/api-user/v3.1/ebikestores?categories=1&showFlag=0&sort=code,asc&limit=100&page=1",
                method: "get",
                contentType: "application/json; charset=utf-8",
                processData: false,
                cache: false,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("firm", sessionStorage.firmFlag);
                    xhr.setRequestHeader("Authorization", sessionStorage.token);
                },
                success: function (data) {
                    var len = data.list.length;
                    $('#sectionName-s').attr("length", '0');
                    for (i = 0; i < len; i++) {
                        $("#sectionName-s3").append($('<option value=' + data.list[i].id + '>' + data.list[i].name + '</option>'));
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    getMissiveType2()
                }
            }
        );
    }

    $(function () {
        $('#datetimepicker1').datetimepicker({
            format: 'YYYY-MM-DD HH:mm:ss'
        });
        $('#datetimepicker2').datetimepicker({
            format: 'YYYY-MM-DD HH:mm:ss'
        });
        $('#datetimepicker3').datetimepicker({
            format: 'YYYY-MM-DD HH:mm:ss',
            defaultDate: getNowFormatDate()
        });
        $('#datetimepicker4').datetimepicker({
            format: 'YYYY-MM-DD HH:mm:ss',
            defaultDate: getNowFormatDate2()
        });
        $('#datetimepicker5').datetimepicker({
            format: 'YYYY-MM-DD HH:mm:ss',
            defaultDate: getNowFormatDate3()
        });
        $('#datetimepicker6').datetimepicker({
            format: 'YYYY-MM-DD HH:mm:ss',
            defaultDate: getNowFormatDate2()
        });

    });

    function getNowFormatDate() {
        var date = new Date();
        var date2 = new Date(date.getTime() - 7 * 24 * 3600 * 1000);
        var seperator1 = "-";
        var seperator2 = ":";
        var month = date2.getMonth() + 1;
        var strDate = date2.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = date2.getFullYear() + seperator1 + month + seperator1 + strDate
            + " " + 00 + seperator2 + 00
            + seperator2 + 00;
        return currentdate;
    }

    function getNowFormatDate2() {
        var date = new Date();
        var seperator1 = "-";
        var seperator2 = ":";
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
            + " " + date.getHours() + seperator2 + date.getMinutes()
            + seperator2 + date.getSeconds();
        return currentdate;
    }

    function getNowFormatDate3() {
        var date = new Date();
        var date2 = new Date(date.getTime() - 30 * 24 * 3600 * 1000);
        var seperator1 = "-";
        var seperator2 = ":";
        var month = date2.getMonth() + 1;
        var strDate = date2.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = date2.getFullYear() + seperator1 + month + seperator1 + strDate
            + " " + 00 + seperator2 + 00
            + seperator2 + 00;
        return currentdate;
    }

</script>
<script src="js/distpicker.data.js"></script>
<script src="js/distpicker.js"></script>
<script src="js/main.js"></script>
</html>
